<!DOCTYPE>
<html>
    <canvas id="hackCanvas" width="400" height="400" style="border: 4px solid;"></canvas>
    <script src="bower_components/jquery/dist/jquery.js"></script>

    <script>
        var canvas = document.getElementById("hackCanvas");
        var ctx = canvas.getContext("2d");
        var canvasWidth = $("#hackCanvas").width();
        var canvasHeight = $("#hackCanvas").height();

        var snake = (function(ctx){
            var tail = [];
            var direction = "right";
            [1, 2, 3].forEach(function(i){
                tail.push(new Pixel(i, 1, 10, ctx))
            });
            
            var head = tail[tail.length - 1];
            var move = function(){
                switch(direction){
                    case "up":
                        var new_head = new Pixel(head.x, head.y - 1, 10, ctx);
                        break;
                    case "down":
                        var new_head = new Pixel(head.x, head.y + 1, 10, ctx);
                        break;
                    case "left":
                        var new_head = new Pixel(head.x - 1, head.y, 10, ctx);
                        break;
                    case "right":
                        var new_head = new Pixel(head.x + 1, head.y, 10, ctx);
                        break;
                    default:
                        var new_head = new Pixel(head.x + 1, head.y, 10, ctx);
                }
                tail.push(new_head);
                tail.shift();
                head = new_head;
            };
            var print = function(){
                tail.forEach(function(pixel){
                    pixel.print();
                })
            };

            var setDirection = function(dir){
                if(dir === "left" && direction === "right" || dir === "right" && direction === "left" || dir === "up" && dir === "down" || dir === "down" && direction === "up" ){
                    return false;
                }
                else{
                    direction = dir;
                }
            };
            var get_head = function(){
                return head;
            };

            var check_borders= function(){
                if(snake.get_head().x <= 0 || snake.get_head().y <= 0 || snake.get_head().x >= canvasWidth / 10 || snake.get_head().y >= canvasHeight / 10){
                }
            };


            return {
                print: print,
                move: move,
                setDirection: setDirection,
                get_head: get_head,
                check_borders: check_borders,
            }
        }(ctx));
        
        initKeyController(function(direction){
            snake.setDirection(direction);
        })
        function initKeyController(cb){
            var keyCodeToDirectionTable = {
                37: "left",
                38: "up",
                39: "right",
                40: "down"
            };
            $(document).keydown(function(e){
                cb(keyCodeToDirectionTable[e.which]);
            })
        }
        setInterval(function(){
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
            snake.print();
            snake.move();
            snake.check_borders();
        }, 100)

        function Pixel(x, y, size, ctx){
            this.x = x;
            this.y = y;
            this.ctx = ctx;
            this.size = size;

            this.print = function(){
                this.ctx.fillStyle = "red";
                this.ctx.fillRect(this.x * this.size, this.y * this.size, this.size, this.size);
            }
        }


    </script>
</html>
